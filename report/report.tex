\documentclass[journal,twocolumn,american]{IEEEtran}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{babel}
\usepackage[pdfusetitle,
 bookmarks=true,bookmarksnumbered=false,bookmarksopen=false,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=false]
 {hyperref}
\usepackage{lipsum}
\usepackage{graphicx}
\usepackage{calc}

% via https://stackoverflow.com/a/123184/8762161
\newlength{\mmdfigureWidthTmp}

\newcommand{\mmdfigure}[2]{\begin{figure}[h]%
    % get the width of the figure unscaled %
    \settowidth{\mmdfigureWidthTmp}{\includegraphics{#1.mmd.pdf}}%
    % give the diagrams a constant scale down regardless of their size. %
    % (based on a rough conversion between their font sizes, assuming i'm correct about those. -amgg) %
    \setlength{\mmdfigureWidthTmp}{\mmdfigureWidthTmp*10/16}%
    % scale that down further but only if necissary to not exceed text width %
    % (note that we use columnwidth here, not textwidth, since we're in a 2-column layout) %
    \setlength{\mmdfigureWidthTmp}{\minof{\mmdfigureWidthTmp}{\columnwidth}}%
    \centering%
    \includegraphics[width=\mmdfigureWidthTmp]{#1.mmd.pdf}%
    \caption{#2}%
\end{figure}%
}

\begin{document}

% title stuff
\title{Project Title}
\author{%
Caleb~Fringer~(0123456789,~caleb.fringer@sjsu.edu)\\%
Adrian~Guerra~(0123456789,~adrian.guerra@sjsu.edu)\\%
Dhananjay~Surti~(0123456789,~dhananjay.surti@sjsu.edu)%
}
\maketitle


\section{Prior Art}
Hello
\lipsum[1]

\section{Goals and Motivation}
\lipsum[1]

\section{Challenges Addressed}
\lipsum[1]

\section{Design}
\lipsum[1]

% \begin{figure}[h]
%     \centering
%     \includegraphics[width=2.5in]{test-uml.mmd.pdf}
%     \caption{Hello world.}
% \end{figure}

\mmdfigure{test-uml}{Hello world.}

\lipsum[2]

\subsection{Log}
\mmdfigure{log-diagram}{Log UML}
\mmdfigure{log-diagram-structure}{Log structure}

\lipsum[3]

\section{Evaluation}
\lipsum[1]

\section{Implementation Details}
Our implementation is divided into two main layers: the Client API Layer and the Consensus Layer.

\subsection{Client API Layer}
The client layer provides several endpoints for interacting with the system. These include operations for creating, deleting, and checking the existence of paths, as well as retrieving and setting data. Additionally, clients can retrieve children of a path and synchronize their state with the server.

\subsection{Consensus Layer}
The consensus layer is built on the Raft protocol, replacing Zookeeper's Zab protocol. It operates with three distinct node states: Follower, Leader, and Candidate.
Each node runs a state machine that delegates tasks to the appropriate handler based on its current role in the cluster.

ElectionServer:
The ElectionServer represents a node in the Raft cluster. It manages the node's identity and network connections to peers via gRPC. It tracks the current term number and log index to monitor cluster progress and maintains state information, indicating whether the node is a FOLLOWER, CANDIDATE, or LEADER.
Communication channels are used to handle AppendEntries and RequestVote RPCs.

Election Algorithm:
The election algorithm governs the behavior of nodes in the cluster:

\textbf{Follower State}: Nodes start as followers, responding to RPCs from leaders and candidates. They use an election timer, randomized between 1500-2000ms, to transition to the candidate state if no heartbeat is received from the leader.

\textbf{Candidate State}: When a follower’s election timer expires, it increments its term and requests votes from all peers. The candidate votes for itself and waits for responses. If it receives votes from a majority, it becomes the leader. If it receives an AppendEntries RPC with a term greater than or equal to its own, it reverts to a follower. If the election times out without achieving a quorum, the candidate restarts the election with a new term.

\textbf{Vote Granting Logic}: Nodes grant votes if they haven’t voted for another candidate in the current term and if the candidate’s log is at least as up-to-date as their own. This ensures that only nodes with complete logs can become leaders.

\textbf{Leader Heartbeats}: Once elected, the leader sends periodic AppendEntries RPCs (heartbeats every 750ms) to all followers. This maintains authority and prevents new elections.

\section{Demonstration}
\lipsum[1]

\section{Performance}
\lipsum[1]

\section{Testing}
\lipsum[1]

\section{Conclusions}
\lipsum[1]


\end{document}

